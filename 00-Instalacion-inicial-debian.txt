# actualizar paquetes y sistema
apt update && apt upgrade -y

# instalar paquetes principales
apt install -y \
    nmap tcpdump \
    iputils-ping lm-sensors iproute2 sudo vim iproute2 curl btop iftop lsof \
    lsb-release wget sysstat snmp snmpd tcpdump \
    ngrep iptraf-ng plocate tar gzip tree ca-certificates \
    screen man-db mailutils dnsutils rsyslog locales snmp snmpd smartmontools

apt install lm-sensors -y

# cambiar host
vim /etc/hostname             # optim5s.local
vim /etc/hosts                # optim5s.local

# configurar dns 
cat /etc/resolv.conf
    nameserver 8.8.8.8
    nameserver 8.8.4.4

# Configuro .bashrc (t√©cnica/gris√°cea)
vim ~/.bashrc
-------------------------------------------------------------------------------------------
# -------------------------------------------------------------------
...
## alias del servidor
alias ls='ls -ha --color=auto --group-directories-first'
alias la='ls $LS_OPTION -lhai --group-directories-first'
alias _liberarespacioram='sudo sync; echo 1 | sudo tee /proc/sys/vm/drop_caches | echo "petici√≥n realizada correctamente." && echo "" && free -h'
alias cp='cp -i'
alias mv='mv -i'
alias rm='rm -i'
alias grep='grep --color=auto'
alias lsblk='lsblk -e7 -o NAME,MAJ:MIN,RM,SIZE,RO,TYPE,MOUNTPOINT,FSTYPE,MODEL,MODE,STATE,VENDOR,UUID'
alias find='find ./ -name'
alias dfi='df -hTi'

## Cambiar dise√±o del prompt (t√©cnica/gris√°cea)
# -------------------------------------------------------------------
# color prompt
PS1='\[\e[0;90m\]\u üåë |‡≤†Áõä‡≤† |\[\e[96m\][\H]\[\e[0m\] \[\e[1;37;41m\] \w \[\e[0m\]$: '

# Opci√≥n t√©cnica/gris√°cea
export LS_COLORS="di=1;30:fi=0;37:ln=1;33:so=1;35:pi=1;33:bd=1;30:cd=1;30:or=1;31:mi=1;31:ex=1;31"
#     di ‚Äî directorios en gris oscuro t√©cnico (bold black)
#     fi ‚Äî archivos normales en gris medio
#     ln ‚Äî enlaces simb√≥licos en amarillo (bold yellow)
#     so ‚Äî sockets en p√∫rpura oscuro (bold magenta)
#     pi ‚Äî pipes (tuber√≠as) en amarillo (bold yellow)
#     bd ‚Äî dispositivos de bloque en gris carb√≥n (bold black)
#     cd ‚Äî dispositivos de car√°cter en gris plomo (bold black)
#     or ‚Äî archivos rotos en rojo sangre oscuro (bold red)
#     mi ‚Äî archivos inexistentes en rojo sangre oscuro (bold red)
#     ex ‚Äî ejecutables en rojo brillante (bold red)

# Editor por defecto
export VISUAL=vim
export EDITOR=vim
...
-------------------------------------------------------------------------------------------

# actualizo
source ~/.bashrc

# Configuro vimrc (t√©cnica/gris√°cea)
vim ~/.vimrc
-------------------------------------------------------------------------------------------
set number                                    " Muestra n√∫meros de l√≠nea
set cursorline                                " Resalta l√≠nea actual
set scrolloff=5                               " Mantiene 5 l√≠neas arriba/abajo
set incsearch                                 " B√∫squeda incremental
set hlsearch                                  " Resalta resultados b√∫squeda
set ignorecase                                " Ignora may√∫sculas/min√∫sculas
set smartcase                                 " Caso sensible si hay may√∫sculas
set expandtab                                 " Usa espacios en lugar de tabs
set tabstop=4                                 " N√∫mero de espacios que representa un tabulador
set shiftwidth=4                              " N√∫mero de espacios para indentaci√≥n autom√°tica
set wildmenu                                  " Mejor autocompletado en la l√≠nea de comandos
syntax on                                     " Activa el resaltado de sintaxis
set background=dark                           " Tema oscuro para el fondo

" Colores personalizados b√°sicos para consola
highlight Normal ctermfg=248 ctermbg=236      " Texto gris medio / fondo gris carb√≥n
highlight LineNr ctermfg=240                  " N√∫meros gris oscuro
highlight CursorLine ctermbg=238              " Fondo l√≠nea cursor gris plomo
highlight Keyword ctermfg=61                  " Palabras clave azul cobalto apagado
highlight Function ctermfg=94                 " Funciones p√∫rpura oscuro
highlight Statement ctermfg=124               " Sentencias rojo sangre oscuro
highlight Visual ctermbg=240                  " Selecci√≥n gris oscuro
highlight Comment ctermfg=3                   " Comentarios en amarillo

set laststatus=2                              " Siempre mostrar l√≠nea de estado
set noerrorbells                              " Sin sonidos de error
set clipboard=unnamedplus                     " Usa portapapeles del sistema
-------------------------------------------------------------------------------------------

# definir sistema de logs
vim /etc/logrotate.conf
-------------------------------------------------------------------------------------------
# logrotate.conf - Elliot 2025
weekly
rotate 52          # 52 semanas = 1 a√±o
dateext
compress
notifempty
maxage 730         # elimina logs > 730 d√≠as (2 a√±os)
create 640 root adm
include /etc/logrotate.d
-------------------------------------------------------------------------------------------

# reinicio servicio de logs
systemctl enable rsyslog
systemctl restart rsyslog

# idioma y hora
localectl set-locale LANG=en_US.UTF-8
localectl
timedatectl set-timezone Europe/Madrid

# Dibujo con ASCII y mensaje de monitorizaci√≥n de bienvenida
vim /etc/bash.bashrc
-------------------------------------------------------------------------------------------
...
# ================= ASCII ART =================
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∂‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£§‚£§‚£§‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚£†‚°∂‚¢ø‚°á‚¢ø‚£ø‚°è‚¢≥‚£¶‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚°õ‚£Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ß‚£º‚£ø‚£¥‚£ã‚°Ω‚†Æ‚†ø‚¢≠‚£ü‚£è‚£∑‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚£ß‚†ò‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°º‚£á‚£ø‚°ø‚†∂‚£∂‚£ø‚£ü‚°õ‚£∑‚£ø‚¢†‚†ô‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚°à‚£è‚†á‚¢π‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°ü‚¢π‚†Å‚£ø‚†ã‚†â‚¢π‚†â‚†ô‚£ø‚°á‚£æ‚£Ä‚£æ‚†Ä‚¢Ä‚£§‚°Ä‚¢Ä‚°Ä‚†Ä‚†Ä‚¢Ä‚£†‚£¥‚£æ‚†õ‚¢ª‚°õ‚¢ª‚°Ñ‚¢Ä‚£≥‚°Ä‚¢Ä‚£†‚†Ñ‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚£∑‚£æ‚¢Ä‚£ø‚°á‚†Ä‚†∏‚†Ä‚†Ä‚£ø‚£ß‚°Ω‚†ø‚£ü‚£∫‚£≠‚†¥‚¢ø‚°è‚£©‚£∑‚°æ‚¢õ‚£≠‚£¥‚£ø‚£á‚†ò‚£ø‚£∑‚£ø‚°õ‚†â‚¢ª‚£ü‚£∑‚†Ñ‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ø‚¢ø‚£ü‚£ø‚£ø‚°¶‚£∂‚£™‚°≠‚†ø‚£ö‚£´‚£≠‚£Ω‚£∂‚°Ñ‚†Ä‚¢∏‚°á‚£ø‚°ô‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£Ü‚†π‚£ø‚£ø‚£∑‚°Ä‚†Ä‚¢ø‚°â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£Ä‚£Ä‚£§‚£∂‚£ø‚†ø‚†õ‚£â‚£≠‚£∂‚£æ‚£ø‚†ø‚†ü‚†õ‚†â‚†â‚¢ª‚†Ä‚¢∏‚£∑‚£ø‚£á‚¢ª‚°ø‚£ø‚£ø‚£ø‚£ø‚†ü‚†Ä‚†π‚£ø‚£ø‚†É‚†Ä‚†ò‚£∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£§‚£¶‚£º‚£ø‚†ø‚†õ‚£ã‚°Å‚£º‚¢†‚£ø‚°ø‚†õ‚†â‚†Å‚†Ä‚†Ä‚¢Ä‚°Ä‚¢Ä‚£¥‚£æ‚†Ä‚¢∏‚£ø‚°á‚¢ª‚°Ñ‚†ô‚†ø‚†ª‚†õ‚†Å‚†Ä‚¢Ä‚£†‚£Ω‚£ø‚£á‚°Ä‚†Ä‚†∏‚£ß‚†Ä‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£æ‚†ø‚£õ‚£≠‚£¥‚°æ‚†ü‚†õ‚£ß‚£ø‚¢∏‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚£∞‚£ø‚£ø‚£∑‚£æ‚£ø‚£ø‚†Ä‚¢∏‚°è‚£á‚¢∏‚£∑‚°Ä‚†Ä‚¢Ä‚£†‚£¥‚£æ‚†ø‚†õ‚£ø‚¢ª‚£ø‚£π‚°Ä‚†Ä‚¢ª‚£Ü‚†Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£¥‚°ü‚£¶‚†Ä‚†Ä‚†Ä‚¢Ä‚°ø‚£µ‚°ø‚†õ‚†â‚£°‚£∂‚£§‚£Ñ‚£ø‚£Ø‚¢∏‚£á‚†Ä‚†Ä‚¢†‚£æ‚£ø‚°ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Ä‚¢∏‚°á‚¢ª‚°º‚£ø‚£∑‚£∂‚†ø‚†õ‚†â‚†Ä‚†Ä‚†Ä‚†∏‚°á‚£ø‚£ø‚£ß‚†Ä‚†ò‚£ø‚°Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚°á‚¢π‚†Ä‚¢Ä‚£†‚£º‚£ø‚£ø‚†Ä‚¢Ä‚£º‚£ø‚£ø‚£ø‚£ø‚°á‚£ø‚¢∏‚£ø‚£Ä‚£Ä‚£ø‚°ø‚†ø‚†∂‚†ö‚†õ‚†â‚†â‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚¢ª‚£æ‚£ù‚£ø‚°Ü‚†Ä‚¢Ä‚£†‚°¥‚†ñ‚†õ‚¢ª‚°æ‚£ø‚£ø‚£Ü‚†Ä‚¢π‚°á‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£á‚£º‚°æ‚†ü‚†ã‚£ø‚¢ª‚£á‚£§‚£å‚†ª‚¢ø‚£ø‚£ø‚£ø‚†É‚¢ø‚†Ä‚†â‚†â‚†Å‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚°§‚†∂‚†∂‚†í‚†ö‚£ª‚£∑‚£Ñ‚†à‚£ø‚£ø‚£ø‚£ø‚°û‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚¢ø‚£ø‚£æ‚£ã‚£Ω‚†á‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£π‚†è‚†Ä‚†Ä‚†Ä‚£ø‚¢ø‚£ø‚£ø‚£Ø‚°¥‚†æ‚†õ‚¢ã‚£°‚†∂‚†õ‚†õ‚†ã‚£â‚£â‚£â‚£ô‚¢ª‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚°ü‚†Ä‚†à‚†ª‚¢¶‚£à‚£ø‚£ø‚£ß‚†Ä‚†Ä‚¢Ä‚£†‚£¥‚°æ‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ä‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚°ü‚£ø‚°ü‚†Ä‚†Ä‚†Ä‚£ø‚†à‚†ã‚†â‚¢Ä‚£†‚†¥‚£õ‚£©‚£§‚£∂‚£û‚£≠‚£ø‚¢ø‚£ø‚£ø‚£ª‚£º‚£ø‚£Ü‚£Ä‚£§‚£§‚£¥‚£ø‚£Ñ‚£†‚£∂‚£¶‚£Ä‚£ô‚£ø‚£ø‚£ø‚°∂‚£ø‚†ü‚†ã‚£Å‚£∂‚†ü‚¢ª‚£Ω‚£ø‚£ø‚£ø‚†á‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚¢†‚£ø‚£á‚†Ä‚†Ä‚†Ä‚¢π‚£†‚°¥‚†ñ‚¢ª‚£∑‚¢´‚£ø‚£ø‚£ø‚£Ø‚£ø‚£ü‚£ø‚£ø‚£≠‚£Ω‚£ø‚°ø‚£ø‚£ø‚£ø‚†ø‚†ø‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚£ø‚†ã‚†â‚£ø‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚£∑‚°Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£º‚£ø‚£ø‚£§‚£¥‚£æ‚¢ø‚°Ö‚†Ä‚£Ä‚£æ‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚£ø‚£∑‚£ø‚£ø‚£ø‚°á‚£ø‚£ø‚°á‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚°ü‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚££‚£ø‚†Å‚£ø‚£Ä‚£§‚°ø‚†Ä‚¢Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†ª‚£ø‚†õ‚†â‚†Ä‚†à‚£ø‚†õ‚¢Ω‚£ø‚¢ª‚£ø‚£ø‚¢ø‚£ø‚£ø‚£ø‚°á‚£ø‚†ø‚£∂‚£∂‚£ö‚£ß‚£ø‚£ø‚°á‚†Ä‚†Ä‚£∏‚£ø‚£ø‚£ø‚£Ñ‚£à‚¢ø‚£ø‚¢ø‚£∑‚£ø‚£ø‚†Ä‚†â‚†â‚†Ä‚†Ä‚†Ä‚†ò‚°á‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚°Ä‚£∑‚°Ü‚†Ä‚†Ä‚†Ä‚†∏‚£ß‚£ª‚£ø‚¢∏‚£ø‚£ø‚°ø‚¢ø‚£æ‚£ª‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†∑‚†æ‚†õ‚†õ‚†ø‚¢ø‚£ø‚£ø‚£ø‚£Ñ‚£ø‚†ø‚†ã‚¢∏‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∑‚°á‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚°æ‚¢ø‚£ø‚£ø‚£ø‚£ø‚°∂‚†∑‚†æ‚†õ‚†õ‚†â‚†Å‚¢Ä‚£†‚†§‚†¥‚†í‚°Ü‚¢†‚†Ä‚¢∞‚°â‚†ª‚£ø‚£Ω‚°è‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°á‚£ø‚°ø‚£ø‚£ø‚£ø‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ß‚£ø‚†ø‚¢Ä‚£Ä‚£§‚£¥‚£ø‚£ø‚£ø‚°∑‚†æ‚†õ‚†ã‚†â‚¢Ä‚£Ä‚£†‚†§‚†¥‚†í‚†ª‚°Ü‚¢∏‚†Ä‚†Ä‚¢Ä‚°†‚†á‚†∏‚°Ñ‚†à‚£á‚†Ä‚†à‚°ª‚¢¶‚°Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°á‚£ø‚£ß‚°ò‚†ø‚¢ª‚°Ü"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ª‚£Ü‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†õ‚£â‚£Ä‚°Ä‚£†‚†¥‚†í‚†ã‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°á‚¢∏‚£†‚†¥‚£´‚°Ñ‚†Ä‚†Ä‚°á‚†Ä‚¢π‚†Ä‚†Ä‚£ø‚†¶‚¢ø‚°Ä‚¢∏‚°á‚†Ä‚†Ä‚£Ä‚£§‚£§‚£ø‚†Ä‚°á‚£ø‚£ø‚£ø‚£Ü‚¢∏‚°á"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£ø‚¢ø‚°ü‚£Ω‚£ø‚†Ä‚£è‚†Å‚†Ä‚°á‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£á‚†Ä‚°ñ‚£ª‚†ã‚†Ä‚†Ä‚†à‚¢ª‚†Ä‚¢à‚°á‚†Ä‚†∏‚°Ñ‚†ò‚£ß‚¢∏‚°á‚†Ä‚¢∏‚£∑‚£æ‚£ø‚†è‚†Ä‚°á‚£ø‚£ø‚£ø‚£ø‚¢∏‚°á"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚†è‚†õ‚†ã‚¢°‚£ø‚†Ä‚†∏‚£ø‚£ü‚°É‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£†‚°§‚†∂‚†í‚†ã‚†Ä‚†õ‚†Å‚†Ä‚£Ä‚£§‚£∂‚£ø‚£ø‚£ø‚£ø‚£∑‚£§‚°à‚†Å‚¢ª‚°û‚£ø‚†Ä‚†à‚†ª‚£¥‚†è‚†Ä‚†Ä‚†ø‚¢π‚£ø‚£é‚¢ª‚£ø‚°á"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚°ü‚†Ä‚†Ä‚¢Ä‚°ø‚£ø‚†Ä‚†Ä‚†à‚†≥‚°á‚†ª‚†§‚†∂‚†ö‚†ã‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚£∂‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†õ‚†ª‚£ø‚£ø‚£ø‚£∑‚£ú‚£∑‚£ø‚†Ä‚†Ä‚¢Ä‚£Ä‚£§‚£§‚£∂‚£æ‚£∂‚£ø‚£ø‚†É‚¢∏‚°á"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚°∂‚†∂‚†ñ‚†ö‚¢õ‚†õ‚†≥‚¢∂‚£º‚°ü‚†Ä‚†Ä‚¢Ä‚£º‚£π‚£ø‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£†‚°§‚¢§‚£æ‚£ø‚£ø‚£ø‚°ø‚†ø‚†õ‚†â‚†π‚°á‚†Ä‚†Ä‚£ø‚£ø‚£ü‚¢ø‚£ø‚£ø‚†π‚£∂‚£ø‚°ø‚†õ‚†ª‚£è‚†Ä‚†â‚†â‚°õ‚£ø‚°ø‚£æ‚°á"
echo "‚†Ä‚†Ä‚†Ä‚¢Ä‚£¥‚†û‚†ã‚¢∞‚°á‚¢∞‚£ø‚¢ª‚¢ª‚¢ª‚¢∂‚£¶‚†ô‚£∑‚°Ä‚†Ä‚£∏‚¢ß‚†ü‚¢ø‚£ø‚£ø‚£ø‚£∑‚£∂‚£∂‚£§‚£¥‚£≤‚°æ‚†ø‚†ü‚†í‚†í‚†õ‚°á‚†ô‚£ø‚†â‚†Ä‚¢ß‚†Ä‚†Ä‚†Ä‚†Ä‚£ß‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚°é‚£ø‚†Å‚¢Ä‚£º‚£è‚¢Ä‚£†‚£§‚£∏‚£∂‚†Ä‚†Ä‚£ø‚£ø‚£ø‚†õ‚†Å"
echo "‚†Ä‚†Ä‚†Ä‚£æ‚†É‚†Ä‚£†‚°¨‚£§‚£º‚£õ‚†æ‚£º‚£û‚°æ‚°ü‚†Ä‚†ò‚£ß‚£†‚£è‚°û‚†Ä‚†à‚†ª‚£ø‚°è‚¢π‚°ü‚†õ‚†ª‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£á‚†Ä‚£ø‚†Ä‚†Ä‚¢∏‚°Ñ‚†Ä‚†Ä‚†Ä‚¢∏‚†Ä‚†Ä‚†ò‚£ø‚£ø‚£á‚£ø‚£¥‚°û‚¢£‚£Ω‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚£ø‚£ø‚°ü‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚£ø‚°∂‚£ø‚£ø‚£∏‚£ø‚£ø‚£ø‚†ø‚†∑‚†æ‚¢Ω‚£Ö‚°≤‚†∂‚¢ª‚£ø‚£º‚¢Å‚£†‚£§‚£∂‚£ø‚£ø‚†ò‚°á‚†Ä‚†Ä‚¢ª‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£∏‚°Ä‚¢π‚°á‚†Ä‚†à‚°á‚†Ä‚†Ä‚†Ä‚†à‚°á‚†Ä‚†Ä‚¢ø‚£ø‚£ø‚¢π‚£ø‚£§‚£ø‚£ø‚£ø‚£ø‚°ø‚¢ø‚£ü‚°Ä‚†Ä‚£ø‚£ø‚°á‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†à‚†õ‚†ø‚¢Ø‚£ú‚£ø‚†è‚†Ä‚†Ä‚†Ä‚¢Ä‚°ø‚£®‚£ø‚£∂‚£§‚£ø‚£∑‚£Ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚°á‚†Ä‚†Ä‚†ê‚°ø‚£¶‚£∞‚£í‚£∂‚£ø‚£ø‚£ø‚£∑‚£æ‚£á‚†Ä‚†Ä‚¢ª‚†Ä‚†Ä‚†Ä‚†Ä‚¢∑‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£æ‚£ø‚£∏‚£ø‚°è‚¢†‚†ü‚£†‚£ø‚£ø‚£ø‚£¶‚°à‚¢π‚°á‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°ü‚£æ‚†Ñ‚†Ä‚†Ä‚£∏‚°á‚£ø‚£ø‚£ø‚†ü‚†ã‚†õ‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ñ‚¢ª‚†Ä‚†Ä‚†Ä‚°á‚†à‚†ô‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚¢∏‚°Ü‚†Ä‚†Ä‚†Ä‚¢∏‚°Ñ‚†Ä‚†Ä‚£ø‚£ø‚£á‚£ø‚†õ‚†õ‚†ª‚£ø‚£∫‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†É‚†Ä‚†Ä"
echo "‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚¢ß‚°á‚†Ä‚†Ä‚†Ä‚£ø‚¢∏‚£ø‚£ø‚°ø‚¢¶‚£¥‚£ø‚£ø‚£∑‚°ø‚£ø‚°ø‚£ø‚°á‚¢∏‚°Ñ‚†Ä‚†Ä‚¢π‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ü‚†Ä‚†Ä‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚£á‚†Ä‚†Ä‚¢∏‚£ø‚£ü‚¢ø‚°Ä‚†Ä‚†Ä‚†à‚†â‚†Ä‚†â‚†â‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä"

# ================= INFO DEL SISTEMA =================
echo
echo "Informaci√≥n del sistema:"

CPU_INFO=$(grep -m1 'model name' /proc/cpuinfo | cut -d ':' -f2 | sed 's/^ //')
RAM_LIBRE=$(free -h | awk '/^Mem:/ {print $7}')
DISK_LIBRE=$(df -h / | awk '$NF=="/" {print $4}')

DISK_WRITTEN=$(awk '
{ sum += $10 }
END {
  gb = sum * 512 / (1024*1024*1024)
  if (gb >= 1024)
    printf "%.2f TB", gb/1024
  else
    printf "%.2f GB", gb
}' /proc/diskstats)

UPTIME_FMT=$(awk '{
  printf "%d days, %d hours, %d minutes",
  int($1/86400),
  int(($1%86400)/3600),
  int(($1%3600)/60)
}' /proc/uptime)

echo "CPU: $CPU_INFO"
echo "RAM libre: $RAM_LIBRE"
echo "Espacio libre en /: $DISK_LIBRE"
echo "Datos escritos desde el arranque: $DISK_WRITTEN"
echo "Tiempo desde el √∫ltimo arranque: $UPTIME_FMT"

sensors 2>/dev/null || echo "No se detectaron sensores."
lsb_release -sd 2>/dev/null || echo "No LSB modules available."
uname -srm
...
-------------------------------------------------------------------------------------------

# recargo el archivo bash.bashrc
source /etc/bash.bashrc

# configuro snmp
cp /etc/snmp/snmpd.conf /etc/snmp/snmpd.conf.ori
vim /etc/snmp/snmpd.conf
-------------------------------------------------------------------------------------------
## SNMPD Configuration | Optim5s (v5) - 07/2025
## puerto por defecto de escucha para SNMP
agentAddress udp:161

# =====[DEFINO-RED-SNMP]============================================================================================
## permite que equipos de esa red consulten SNMP con esa comunidad
# **rocommunity**	: Read-Only
# **rwcommunity**	: Read-Write
rocommunity HandShake_25 localhost
rocommunity HandShake_25 39.1.0.0/16
rocommunity HandShake_25 192.168.1.0/24

# =====[SOBREESCRIBIR-VALORES]======================================================================================
## sobreescribo o fuerzo OIDs existentes
syslocation "ü§ñ CPD"
syscontact "ü§ñ Informatica <informatica@prime.es>"

# =====[DOCUMENTACI√ìN-OIDS]=========================================================================================
## OIDs importantes definidos por defecto:
# sysObjectID: .1.3.6.1.2.1.1.2                  # Identificador √∫nico del objeto del sistema (por ejemplo, el tipo de dispositivo)
# sysDescr: .1.3.6.1.2.1.1.1                     # Descripci√≥n del sistema (por ejemplo, el modelo y la versi√≥n del firmware)
# sysUpTime: .1.3.6.1.2.1.1.3                    # Tiempo que el sistema ha estado funcionando desde el √∫ltimo reinicio
# sysContact: .1.3.6.1.2.1.1.4                   # Informaci√≥n de contacto del administrador del sistema
# sysName: .1.3.6.1.2.1.1.5                      # Nombre del sistema
# sysLocation: .1.3.6.1.2.1.1.6                  # Ubicaci√≥n f√≠sica del sistema
# sysServices: .1.3.6.1.2.1.1.7                  # Servicios disponibles en el sistema (por ejemplo, SNMP, HTTP, FTP)

# =====[PERSONALIZACI√ìN-RAMAS]======================================================================================
## integrar scripts o comandos externos a SNMP
# expone un OID personalizado que ejecuta comandos del sistema y exponen su salida
#extend test1 /bin/echo "Hello world"

# pass - expone un OID que devuelve seg√∫n este ejemplo de script la temperatura del servidor
#pass .1.3.6.1.4.1.2021.100 /usr/local/bin/check_temp.sh

# pass_persist - script se ejecute una sola vez y permanezca en memoria, √∫til para m√©tricas que se consultan muy seguidas
#pass_persist .1.3.6.1.4.1.2021.101 /usr/local/bin/check_metrics_persist.sh

# =====[ACCESOS-RESTRICTIVOS]=======================================================================================
## restringe el acceso solo a esos OIDs espec√≠ficos del sistema
view systemonly included .1.3.6.1.2.1.1.1        # Descripci√≥n del sistema (sysDescr)
view systemonly included .1.3.6.1.2.1.1.2        # Identificador √∫nico del objeto del sistema (sysObjectID)
view systemonly included .1.3.6.1.2.1.1.6        # Ubicaci√≥n f√≠sica del sistema (sysLocation)

# =====[PERMISOS-VISTAS]============================================================================================
## Restringe todo el √°rbol MIB y limita la informaci√≥n expuesta, permitiendo √∫nicamente el acceso a los OIDs definidos expl√≠citamente en la vista (ACCESOS-RESTRICTIVOS)
# Permitir acceso de lectura para la vista definida
access readonly "" any noauth exact systemonly none none

# Permitir acceso de lectura y escritura para la vista definida
#access rwcommunity "" any noauth exact systemonly none none

# Permitir acceso de lectura y escritura con autenticaci√≥n y cifrado para la vista definida
#access rwcommunity "" any authPriv exact all none none
-------------------------------------------------------------------------------------------

# reinicio servicio
systemctl start snmpd
systemctl enable snmpd

# (Cron + ntpdate, actualizaci√≥n puntual) => para equipos de bajo rendimiento: Ejecuta ntpdate una vez al d√≠a mediante cron, sincronizando ntp. 
apt install -y ntpsec-ntpdate
/usr/sbin/ntpdate hora.roa.es
echo "00 6 * * * /usr/sbin/ntpdate -s hora.roa.es" | crontab -l 2>/dev/null | grep -v 'ntpdate -s hora.roa.es' | { cat; echo "00 6 * * * /usr/sbin/ntpdate -s hora.roa.es"; } | crontab -
   # -l = lista crontab actual
   # 2>/dev/null = evita error si no existe crontab previo
   # grep -v = evita duplicados
   # cat + echo = a√±ade nueva l√≠nea

# SAR Habilitamos monitorizacion
sed -i 's/ENABLED="false"/ENABLED="true"/g' /etc/default/sysstat
systemctl enable sysstat
systemctl start sysstat

# Deshabilitar IPv6
echo -e "# Deshabilitamos IPv6\nnet.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1\nnet.ipv6.conf.lo.disable_ipv6 = 1" >> /etc/sysctl.conf
sysctl -p

# crear archivo swap de X-GB (si es necesario)
sudo fallocate -l 8G /swapfile
sudo chmod 600 /swapfile
mkswap /swapfile
sudo swapon /swapfile
swapon --show
free -h
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# Archivo iptables
apt install iptables iptables-persistent -y
systemctl enable netfilter-persistent

# iptables v4
vim /etc/iptables/rules.v4
-------------------------------------------------------------------------------------------
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
# SSH
-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
# Permitir HTTP (puerto 80) y HTTPS (puerto 443) si es necesario un panel web
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 443 -j ACCEPT
# Ejemplo:: Permitimos recibir respuestas DHCP si nuestra IP es din√°mica
#-A INPUT -p udp --sport 67 --dport 68 -j ACCEPT
#-A OUTPUT -p udp --sport 68 --dport 67 -j ACCEPT
# Ejemplo:: Permitir acceso al panel web de administraci√≥n Greenbone
#-A INPUT -p tcp --dport 9392 -j ACCEPT
# Cerramos resto
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
-------------------------------------------------------------------------------------------

# iptables v6
vim /etc/iptables/rules.v6
-------------------------------------------------------------------------------------------
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p ipv6-icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
# Ejemplo:: SSH
#-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
# Cerramos el resto
-A INPUT -j REJECT --reject-with icmp6-adm-prohibited
-A FORWARD -j REJECT --reject-with icmp6-adm-prohibited
COMMIT
-------------------------------------------------------------------------------------------

# inicio servicio
systemctl start iptables
systemctl start ip6tables 
ip6tables -L -n
systemctl restart iptables

# configuraci√≥n SSH (si es necesario)
apt install -y openssh-server
# Evitar suspensi√≥n en el contenedor
systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target
vim /etc/ssh/sshd_config
-------------------------------------------------------------------------------------------
...
Port 22
PermitRootLogin yes
AddressFamily inet
ListenAddress 0.0.0.0
...
-------------------------------------------------------------------------------------------

# Habilitar e iniciar servicio
systemctl enable ssh
systemctl start ssh
systemctl status ssh

# Reiniciar sistema
exec bash
reboot now




